<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ§ SA-MP Radio Station</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <header>
      <h1>ğŸ™ï¸ SA-MP Radio Station Control Panel</h1>
      <p>Administra tus estaciones y transmisiones fÃ¡cilmente</p>
    </header>

    <main>
      <section class="create-section">
        <h2>â• Crear nueva estaciÃ³n</h2>
        <input
          type="text"
          id="stationName"
          placeholder="Nombre de la estaciÃ³n"
        />
        <button onclick="createStation()">Crear</button>
        <p id="createMsg"></p>
      </section>

      <section class="stations-section">
        <h2>ğŸ“» Estaciones actuales</h2>
        {% if stations %}
        <div class="station-grid">
          {% for station in stations %}
          <div class="station-card">
            <h3>{{ station.name }}</h3>
            <p>Canciones: {{ station.song_count }}</p>
            <p>
              <strong>Stream:</strong>
              <a href="{{ station.stream_link }}" target="_blank"
                >{{ station.stream_link }}</a
              >
            </p>
            <button onclick="viewSongs('{{ station.name }}')">
              Ver canciones
            </button>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p>No hay estaciones creadas aÃºn.</p>
        {% endif %}
      </section>

      <section id="songsSection" style="display: none">
        <h2>ğŸµ Canciones en <span id="stationTitle"></span></h2>
        <ul id="songList"></ul>
      </section>
    </main>

    <footer>
      <p>Hecho con â¤ï¸ por Erick Mota | Flask + Icecast + Render</p>
    </footer>

    <script>
      async function createStation() {
        const name = document.getElementById("stationName").value;
        if (!name.trim()) return alert("Ingresa un nombre vÃ¡lido");

        const res = await fetch("/create_station", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name }),
        });
        const data = await res.json();
        document.getElementById("createMsg").innerText = data.message;
        if (data.success) location.reload();
      }

      function viewSongs(station) {
        fetch(`/static/stations/${station}/`)
          .then((res) => {
            if (!res.ok) throw new Error("No se puede acceder a las canciones");
            document.getElementById("stationTitle").innerText = station;
            document.getElementById("songsSection").style.display = "block";
          })
          .catch(() =>
            alert(
              "No hay canciones disponibles o no se puede acceder al directorio."
            )
          );
      }
    </script>
  </body>
</html>
