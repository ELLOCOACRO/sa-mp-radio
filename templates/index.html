<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SA-MP Radio Station</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <h1>ðŸŽ§ SA-MP Radio Station</h1>
      <p>Bienvenido a tu panel de control de emisoras</p>

      <div class="buttons">
        <button id="btnCreate">âž• Crear estaciÃ³n</button>
        <button id="btnSongs">ðŸŽµ Ver canciones</button>
        <button id="btnTrack">ðŸ“» Track Info</button>
      </div>

      <div class="info">
        <p>
          <strong>Stream Link:</strong>
          <span id="streamLink">{{ stream_link }}</span>
        </p>
        <p id="status">Estado: verificando...</p>
      </div>

      <div id="output"></div>
    </div>

    <script>
      const btnCreate = document.getElementById("btnCreate");
      const btnSongs = document.getElementById("btnSongs");
      const btnTrack = document.getElementById("btnTrack");
      const output = document.getElementById("output");
      const statusEl = document.getElementById("status");

      async function checkStatus() {
        const res = await fetch("/status");
        const data = await res.json();
        statusEl.innerText = `Estado: ${data.status} (Puerto Icecast: ${data.icecast_port})`;
      }

      btnCreate.onclick = async () => {
        const name = prompt("Nombre de la estaciÃ³n:");
        if (!name) return;
        const res = await fetch("/create_station", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `name=${encodeURIComponent(name)}`,
        });
        const data = await res.json();
        output.innerText = data.message || data.error;
      };

      btnSongs.onclick = async () => {
        const res = await fetch("/songs");
        const data = await res.json();
        output.innerHTML =
          "<h3>ðŸŽ¶ Canciones disponibles:</h3><ul>" +
          data.map((song) => `<li>${song}</li>`).join("") +
          "</ul>";
      };

      btnTrack.onclick = async () => {
        output.innerHTML = "<p>ðŸ“¡ Consultando track actual...</p>";
        const res = await fetch("/status");
        const data = await res.json();
        output.innerHTML = `<p>ðŸŽ§ Stream activo en puerto ${data.icecast_port}</p>`;
      };

      checkStatus();
    </script>
  </body>
</html>
