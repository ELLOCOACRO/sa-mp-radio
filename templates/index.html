<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SA-MP Radio | Panel de Estaciones</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <header>
      <h1>ğŸµ SA-MP Radio</h1>
      <p>Emisoras y transmisiones en directo</p>
    </header>

    <section class="create-station">
      <h2>Crear nueva estaciÃ³n</h2>
      <input
        type="text"
        id="stationName"
        placeholder="Nombre de la estaciÃ³n..."
      />
      <button id="createStationBtn">Crear estaciÃ³n</button>
      <p id="createStatus"></p>
    </section>

    <section class="stations">
      <h2>ğŸ™ï¸ Estaciones disponibles</h2>
      {% if stations %} {% for station in stations.values() %}
      <div class="station">
        <h3>{{ station.name }}</h3>
        <p>
          <strong>Canciones:</strong> {{ station.songs|join(', ') if
          station.songs else 'Sin canciones aÃºn.' }}
        </p>
        <button class="start-btn" onclick="startStream('{{ station.name }}')">
          Iniciar transmisiÃ³n
        </button>
        <button class="stop-btn" onclick="stopStream('{{ station.name }}')">
          Detener transmisiÃ³n
        </button>
        <audio
          id="player-{{ station.name }}"
          controls
          style="display: none; margin-top: 10px"
        ></audio>
        <p id="status-{{ station.name }}" class="status"></p>
      </div>
      {% endfor %} {% else %}
      <p>No hay estaciones creadas todavÃ­a.</p>
      {% endif %}
    </section>

    <footer>
      <p>Desarrollado por Erick âš¡ | Proyecto Flask + Icecast</p>
    </footer>

    <script>
      // Crear estaciÃ³n
      document
        .getElementById("createStationBtn")
        .addEventListener("click", async () => {
          const name = document.getElementById("stationName").value.trim();
          const status = document.getElementById("createStatus");
          if (!name) {
            status.textContent = "âš ï¸ Debes ingresar un nombre.";
            return;
          }
          status.textContent = "â³ Creando estaciÃ³n...";
          const res = await fetch("/create_station", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name }),
          });
          const data = await res.json();
          status.textContent = data.message || data.error;
          if (!data.error) setTimeout(() => location.reload(), 1500);
        });

      // Iniciar transmisiÃ³n
      async function startStream(name) {
        const status = document.getElementById(`status-${name}`);
        status.textContent = "ğŸ”„ Iniciando transmisiÃ³n...";
        const res = await fetch("/start_stream", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name }),
        });
        const data = await res.json();
        if (data.error) {
          status.textContent = "âŒ " + data.error;
        } else {
          status.textContent = "âœ… " + data.message;
          const audio = document.getElementById(`player-${name}`);
          audio.src = data.url;
          audio.style.display = "block";
          audio.play();
        }
      }

      // Detener transmisiÃ³n
      async function stopStream(name) {
        const status = document.getElementById(`status-${name}`);
        status.textContent = "ğŸ›‘ Deteniendo transmisiÃ³n...";
        const res = await fetch("/stop_stream", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name }),
        });
        const data = await res.json();
        status.textContent = data.message || data.error;
        const audio = document.getElementById(`player-${name}`);
        audio.pause();
        audio.style.display = "none";
      }
    </script>
  </body>
</html>
